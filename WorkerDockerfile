FROM ubuntu:18.04
LABEL maintainer="willnx84@gmail.com"

RUN apt update && apt upgrade --yes
RUN apt install --yes wget python3 python3-dev openssl gcc \
             libc-dev libffi-dev libpcre3 libpcre3-dev firefox

RUN wget --no-check-certificate -O /tmp/get-pip.py https://bootstrap.pypa.io/get-pip.py && \
    python3 /tmp/get-pip.py && \
    rm /tmp/get-pip.py

COPY geckodriver /usr/local/bin
COPY dist/*.whl /tmp

RUN pip install /tmp/*.whl && rm /tmp/*.whl
RUN apt remove --yes gcc

WORKDIR /usr/local/lib/python3.6/dist-packages/vlab_onefs_api/lib/worker

CMD ["celery", "-A", "tasks", "worker", "--time-limit", "3600"]
